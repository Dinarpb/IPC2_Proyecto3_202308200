{% extends 'template.html' %}
{% block content %}
<div class="container-fluid mt-4"> <h2>Consultar Datos del Sistema</h2>
    <a href="{% url 'operaciones' %}" class="btn btn-secondary mb-3">Volver a
        Operaciones</a>

    {% if error %}
    <div class="alert alert-danger" role="alert">
        {{ error }}
    </div>
    {% elif datos %}

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="recursos-tab"
                data-bs-toggle="tab" data-bs-target="#recursos-tab-pane"
                type="button" role="tab">
                Recursos ({{ datos.recursos_disponibles|length }})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="categorias-tab" data-bs-toggle="tab"
                data-bs-target="#categorias-tab-pane" type="button" role="tab">
                Categorías ({{ datos.categorias_disponibles|length }})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="clientes-tab" data-bs-toggle="tab"
                data-bs-target="#clientes-tab-pane" type="button" role="tab">
                Clientes ({{ datos.clientes_registrados|length }})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="consumos-tab" data-bs-toggle="tab"
                data-bs-target="#consumos-tab-pane" type="button" role="tab">
                Consumos ({{ datos.consumos_registrados|length }})
            </button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">

        <div class="tab-pane fade show active" id="recursos-tab-pane"
            role="tabpanel">
            <div class="table-responsive mt-3">
                <table class="table table-striped table-bordered table-sm">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Abreviatura</th>
                            <th>Métrica</th>
                            <th>Tipo</th>
                            <th>Valor/Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for recurso in datos.recursos_disponibles %}
                        <tr>
                            <td>{{ recurso.id }}</td>
                            <td>{{ recurso.nombre }}</td>
                            <td>{{ recurso.abreviatura }}</td>
                            <td>{{ recurso.metrica }}</td>
                            <td>{{ recurso.tipo }}</td>
                            <td>Q. {{ recurso.valorXhora }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">No hay recursos
                                cargados.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="categorias-tab-pane" role="tabpanel">
            <div class="table-responsive mt-3">
                <table class="table table-striped table-bordered table-sm">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Descripción</th>
                            <th>Carga Trabajo</th>
                            <th>Configuraciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for categoria in datos.categorias_disponibles %}
                        <tr>
                            <td>{{ categoria.id }}</td>
                            <td>{{ categoria.nombre }}</td>
                            <td>{{ categoria.descripcion }}</td>
                            <td>{{ categoria.cargaTrabajo }}</td>
                            <td>
                                <ul>
                                    {% for config in categoria.configuraciones
                                    %}
                                    <li>
                                        <strong>{{ config.nombre }} (ID: {{
                                            config.id }}):</strong> {{
                                        config.descripcion }}
                                        <ul>
                                            {% for rec in config.recursos %}
                                            <li>Recurso ID {{ rec.id }}: {{
                                                rec.cantidad }}</li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                    {% empty %}
                                    <li>Sin configuraciones.</li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center">No hay
                                categorías cargadas.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="clientes-tab-pane" role="tabpanel">
            <div class="table-responsive mt-3">
                <table class="table table-striped table-bordered table-sm">
                    <thead class="table-dark">
                        <tr>
                            <th>NIT</th>
                            <th>Nombre</th>
                            <th>Usuario</th>
                            <th>Dirección</th>
                            <th>Correo</th>
                            <th>Instancias</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cliente in datos.clientes_registrados %}
                        <tr>
                            <td>{{ cliente.nit }}</td>
                            <td>{{ cliente.nombre }}</td>
                            <td>{{ cliente.usuario }}</td>
                            <td>{{ cliente.direccion }}</td>
                            <td>{{ cliente.correoElectronico }}</td>
                            <td>
                                <ul>
                                    {% for instancia in cliente.instancias %}
                                    <li>
                                        <strong>{{ instancia.nombre }} (ID: {{
                                            instancia.id }})</strong>
                                        <br>
                                        Config ID: {{ instancia.idConfiguracion
                                        }}
                                        <br>
                                        Estado: {{ instancia.estado }}
                                        <br>
                                        Inicio: {{ instancia.fechaInicio }}

                                        {% if instancia.fechaFinal %}
                                        <br>
                                        <span class="text-danger">Fin: {{
                                            instancia.fechaFinal }}</span>
                                        {% endif %}
                                    </li>
                                    {% empty %}
                                    <li>Sin instancias.</li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">No hay clientes
                                cargados.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="consumos-tab-pane" role="tabpanel">
            <div class="table-responsive mt-3">
                <table class="table table-striped table-bordered table-sm">
                    <thead class="table-dark">
                        <tr>
                            <th>NIT Cliente</th>
                            <th>ID Instancia</th>
                            <th>Tiempo (horas)</th>
                            <th>Fecha y Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for consumo in datos.consumos_registrados %}
                        <tr>
                            <td>{{ consumo.nitCliente }}</td>
                            <td>{{ consumo.idInstancia }}</td>
                            <td>{{ consumo.tiempo }}</td>
                            <td>{{ consumo.fechaHora }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center">No hay consumos
                                registrados.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {% else %}
    <div class="alert alert-info" role="alert">
        No hay datos para mostrar. El sistema no ha sido cargado.
    </div>
    {% endif %}
</div>
{% endblock %}